<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.5 Conditional Unconfoundedness assumption | Causal Inference</title>
  <meta name="description" content="2.5 Conditional Unconfoundedness assumption | Causal Inference" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="2.5 Conditional Unconfoundedness assumption | Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.5 Conditional Unconfoundedness assumption | Causal Inference" />
  
  
  

<meta name="author" content="Vinish Shrestha" />


<meta name="date" content="2024-07-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="an-estimation-example.html"/>
<link rel="next" href="discussion.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Work in Progress</a></li>
<li class="chapter" data-level="2" data-path="causal-inference-an-introduction.html"><a href="causal-inference-an-introduction.html"><i class="fa fa-check"></i><b>2</b> Causal Inference: An Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="potential-outcome-framework-neyman-rubin-causal-model.html"><a href="potential-outcome-framework-neyman-rubin-causal-model.html"><i class="fa fa-check"></i><b>2.1</b> Potential Outcome Framework: Neyman-Rubin Causal Model</a></li>
<li class="chapter" data-level="2.2" data-path="average-treatment-effect-ate.html"><a href="average-treatment-effect-ate.html"><i class="fa fa-check"></i><b>2.2</b> Average treatment effect (ATE)</a></li>
<li class="chapter" data-level="2.3" data-path="average-treatment-effect-on-the-treated-att.html"><a href="average-treatment-effect-on-the-treated-att.html"><i class="fa fa-check"></i><b>2.3</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="2.4" data-path="an-estimation-example.html"><a href="an-estimation-example.html"><i class="fa fa-check"></i><b>2.4</b> An estimation example</a></li>
<li class="chapter" data-level="2.5" data-path="conditional-unconfoundedness-assumption.html"><a href="conditional-unconfoundedness-assumption.html"><i class="fa fa-check"></i><b>2.5</b> Conditional Unconfoundedness assumption</a></li>
<li class="chapter" data-level="2.6" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>2.6</b> Discussion</a></li>
<li class="chapter" data-level="2.7" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>2.7</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ipw-and-aipw.html"><a href="ipw-and-aipw.html"><i class="fa fa-check"></i><b>3</b> IPW and AIPW</a>
<ul>
<li class="chapter" data-level="3.1" data-path="motivation.html"><a href="motivation.html"><i class="fa fa-check"></i><b>3.1</b> Motivation</a></li>
<li class="chapter" data-level="3.2" data-path="a-simple-example.html"><a href="a-simple-example.html"><i class="fa fa-check"></i><b>3.2</b> A simple example</a></li>
<li class="chapter" data-level="3.3" data-path="continuous-features-and-propensity-score.html"><a href="continuous-features-and-propensity-score.html"><i class="fa fa-check"></i><b>3.3</b> Continuous features and propensity score</a></li>
<li class="chapter" data-level="3.4" data-path="propensity-score-stratification.html"><a href="propensity-score-stratification.html"><i class="fa fa-check"></i><b>3.4</b> Propensity score stratification</a></li>
<li class="chapter" data-level="3.5" data-path="ipw-and-estimation.html"><a href="ipw-and-estimation.html"><i class="fa fa-check"></i><b>3.5</b> IPW and Estimation</a></li>
<li class="chapter" data-level="3.6" data-path="aipw-and-estimation.html"><a href="aipw-and-estimation.html"><i class="fa fa-check"></i><b>3.6</b> AIPW and Estimation</a></li>
<li class="chapter" data-level="3.7" data-path="assessing-balance.html"><a href="assessing-balance.html"><i class="fa fa-check"></i><b>3.7</b> Assessing Balance</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="causal-forest.html"><a href="causal-forest.html"><i class="fa fa-check"></i><b>4</b> Causal Forest</a>
<ul>
<li class="chapter" data-level="4.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="summary-of-grf.html"><a href="summary-of-grf.html"><i class="fa fa-check"></i><b>4.2</b> Summary of GRF</a></li>
<li class="chapter" data-level="4.3" data-path="motivation-for-causal-forests.html"><a href="motivation-for-causal-forests.html"><i class="fa fa-check"></i><b>4.3</b> Motivation for Causal Forests</a></li>
<li class="chapter" data-level="4.4" data-path="causal-forest-1.html"><a href="causal-forest-1.html"><i class="fa fa-check"></i><b>4.4</b> Causal Forest</a></li>
<li class="chapter" data-level="4.5" data-path="an-example-of-causal-forest.html"><a href="an-example-of-causal-forest.html"><i class="fa fa-check"></i><b>4.5</b> An example of causal forest</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="heterogeneous-treatment-effects.html"><a href="heterogeneous-treatment-effects.html"><i class="fa fa-check"></i><b>5</b> Heterogeneous Treatment Effects</a>
<ul>
<li class="chapter" data-level="5.1" data-path="some-ways-to-estimate-cate.html"><a href="some-ways-to-estimate-cate.html"><i class="fa fa-check"></i><b>5.1</b> Some ways to estimate CATE</a></li>
<li class="chapter" data-level="5.2" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>5.2</b> Estimation</a></li>
<li class="chapter" data-level="5.3" data-path="some-remarks-and-questions.html"><a href="some-remarks-and-questions.html"><i class="fa fa-check"></i><b>5.3</b> Some Remarks and Questions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="conditional-unconfoundedness-assumption" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Conditional Unconfoundedness assumption<a href="conditional-unconfoundedness-assumption.html#conditional-unconfoundedness-assumption" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most of the time the treatment assignment may not be fully random but can be driven by some selective covariates. Referring to the tutoring example, it may be unethical to disallow someone in the control group who wants to attend the tutoring sessions. As such, tutoring sessions may be voluntarily held, where students systematically select whether to attend the sessions.</p>
<p>Say, females and Blacks are more likely to attend the tutoring session and both of these variables are also likely to yield higher potential outcome. This means that females and Blacks are more likely to have higher exam score in absence of the treatment compared to males and Whites. It is easy to see that the treatment assignment is correlated with the potential outcomes and the <strong>independence assumption</strong> is violated. This is true in many cases of observational settings and even in randomized experiments. We require some adjustments before being able to estimate treatment effects in such cases.</p>
<p>If we know the treatment mechanism fairly well then we can still proceed further to estimate the treatment effects. For example, treatment assignment is (voluntarily)
more tilted towards females than males or Blacks than Whites. In this case, we would want to invoke <strong>conditional independence</strong> assumption. Formally, this states that <span class="math inline">\(Y_i(0), \; Y_i(1) \perp W_i | X_i\)</span>. This means that conditional upon the covariates, the treatment assignment will be more or less random. Here, one would want to estimate ATT within each strata: <span class="math inline">\(i)\)</span> female-Black, <span class="math inline">\(ii)\)</span> female-White, <span class="math inline">\(iii)\)</span> male-Black, and <span class="math inline">\(iv)\)</span> male-White, and take a weighted average of the strata-specific ATEs by using the proportion of the sample in the given strata as weights. The conditional independence assumption means that within each strata treatment assignment is random. The following example illustrates this concept. Note that the true treatment effect is 10.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="conditional-unconfoundedness-assumption.html#cb8-1" aria-hidden="true" tabindex="-1"></a> fun_ATE2  <span class="ot">&lt;-</span> <span class="cf">function</span>(N, tau){</span>
<span id="cb8-2"><a href="conditional-unconfoundedness-assumption.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="conditional-unconfoundedness-assumption.html#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># @arg tau: true treatment effect</span></span>
<span id="cb8-4"><a href="conditional-unconfoundedness-assumption.html#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># @arg N:   sample size</span></span>
<span id="cb8-5"><a href="conditional-unconfoundedness-assumption.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Return tau_hat: estimate of the treatment effect using conditional randomness assumption   </span></span>
<span id="cb8-6"><a href="conditional-unconfoundedness-assumption.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Return tau_hat2: estimate of the treatment effect wrongly using unconditional independence assumption</span></span>
<span id="cb8-7"><a href="conditional-unconfoundedness-assumption.html#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Return reg_tau: estimate from conditioning using regression but from a misspecified model</span></span>
<span id="cb8-8"><a href="conditional-unconfoundedness-assumption.html#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="conditional-unconfoundedness-assumption.html#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create pseudo data</span></span>
<span id="cb8-10"><a href="conditional-unconfoundedness-assumption.html#cb8-10" aria-hidden="true" tabindex="-1"></a>    gender  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb8-11"><a href="conditional-unconfoundedness-assumption.html#cb8-11" aria-hidden="true" tabindex="-1"></a>    race  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb8-12"><a href="conditional-unconfoundedness-assumption.html#cb8-12" aria-hidden="true" tabindex="-1"></a>    W  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> (gender <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> (race <span class="sc">&gt;</span> <span class="dv">0</span>))    </span>
<span id="cb8-13"><a href="conditional-unconfoundedness-assumption.html#cb8-13" aria-hidden="true" tabindex="-1"></a>    Y  <span class="ot">&lt;-</span> <span class="dv">40</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> W  <span class="sc">+</span> gender <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> race <span class="sc">*</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">25</span> <span class="sc">*</span> race <span class="sc">*</span> gender <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb8-14"><a href="conditional-unconfoundedness-assumption.html#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="conditional-unconfoundedness-assumption.html#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># female-Blacks</span></span>
<span id="cb8-16"><a href="conditional-unconfoundedness-assumption.html#cb8-16" aria-hidden="true" tabindex="-1"></a>    tau_hat1  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) </span>
<span id="cb8-17"><a href="conditional-unconfoundedness-assumption.html#cb8-17" aria-hidden="true" tabindex="-1"></a>    w1  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb8-18"><a href="conditional-unconfoundedness-assumption.html#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="conditional-unconfoundedness-assumption.html#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># female-Whites</span></span>
<span id="cb8-20"><a href="conditional-unconfoundedness-assumption.html#cb8-20" aria-hidden="true" tabindex="-1"></a>    tau_hat2  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) </span>
<span id="cb8-21"><a href="conditional-unconfoundedness-assumption.html#cb8-21" aria-hidden="true" tabindex="-1"></a>    w2  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> N</span>
<span id="cb8-22"><a href="conditional-unconfoundedness-assumption.html#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="conditional-unconfoundedness-assumption.html#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># male-Blacks</span></span>
<span id="cb8-24"><a href="conditional-unconfoundedness-assumption.html#cb8-24" aria-hidden="true" tabindex="-1"></a>    tau_hat3  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) </span>
<span id="cb8-25"><a href="conditional-unconfoundedness-assumption.html#cb8-25" aria-hidden="true" tabindex="-1"></a>    w3  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb8-26"><a href="conditional-unconfoundedness-assumption.html#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="conditional-unconfoundedness-assumption.html#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># male-Whites</span></span>
<span id="cb8-28"><a href="conditional-unconfoundedness-assumption.html#cb8-28" aria-hidden="true" tabindex="-1"></a>    tau_hat4  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) </span>
<span id="cb8-29"><a href="conditional-unconfoundedness-assumption.html#cb8-29" aria-hidden="true" tabindex="-1"></a>    w4  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> N</span>
<span id="cb8-30"><a href="conditional-unconfoundedness-assumption.html#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="conditional-unconfoundedness-assumption.html#cb8-31" aria-hidden="true" tabindex="-1"></a>    tau_hat  <span class="ot">&lt;-</span> tau_hat1 <span class="sc">*</span> w1 <span class="sc">+</span> tau_hat2 <span class="sc">*</span> w2 <span class="sc">+</span> tau_hat3 <span class="sc">*</span> w3 <span class="sc">+</span> tau_hat4 <span class="sc">*</span> w4</span>
<span id="cb8-32"><a href="conditional-unconfoundedness-assumption.html#cb8-32" aria-hidden="true" tabindex="-1"></a>    tau_hat2  <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb8-33"><a href="conditional-unconfoundedness-assumption.html#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="conditional-unconfoundedness-assumption.html#cb8-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a mis-specified regression model</span></span>
<span id="cb8-35"><a href="conditional-unconfoundedness-assumption.html#cb8-35" aria-hidden="true" tabindex="-1"></a>    reg  <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> W <span class="sc">+</span> gender)</span>
<span id="cb8-36"><a href="conditional-unconfoundedness-assumption.html#cb8-36" aria-hidden="true" tabindex="-1"></a>    reg_tau  <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(reg)[[<span class="dv">2</span>]]</span>
<span id="cb8-37"><a href="conditional-unconfoundedness-assumption.html#cb8-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-38"><a href="conditional-unconfoundedness-assumption.html#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">table</span>(gender[W <span class="sc">==</span> <span class="dv">1</span>]), <span class="fu">table</span>(race[W <span class="sc">==</span> <span class="dv">1</span>]), tau_hat, tau_hat2, reg_tau))</span>
<span id="cb8-39"><a href="conditional-unconfoundedness-assumption.html#cb8-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-40"><a href="conditional-unconfoundedness-assumption.html#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="conditional-unconfoundedness-assumption.html#cb8-41" aria-hidden="true" tabindex="-1"></a>ATE2_results  <span class="ot">&lt;-</span> <span class="fu">fun_ATE2</span>(<span class="at">N =</span> <span class="dv">20000</span>, <span class="at">tau =</span> <span class="dv">10</span>)</span>
<span id="cb8-42"><a href="conditional-unconfoundedness-assumption.html#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;treated males: &quot;</span>, <span class="st">&quot;treated females: &quot;</span>) , ATE2_results[[<span class="dv">1</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;treated males:  2973&quot;   &quot;treated females:  7012&quot;</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="conditional-unconfoundedness-assumption.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;treated Whites: &quot;</span>, <span class="st">&quot;treated Blacks: &quot;</span>) , ATE2_results[[<span class="dv">2</span>]])) </span></code></pre></div>
<pre><code>## [1] &quot;treated Whites:  3934&quot; &quot;treated Blacks:  6051&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="conditional-unconfoundedness-assumption.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;ATE conditioned on Xs is :&quot;</span>, ATE2_results[[<span class="dv">3</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;ATE conditioned on Xs is : 9.89519007543134&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="conditional-unconfoundedness-assumption.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;ATE not conditioned on Xs is :&quot;</span>, ATE2_results[[<span class="dv">4</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;ATE not conditioned on Xs is : 19.5342168578966&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="conditional-unconfoundedness-assumption.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get tau_hats from replications </span></span>
<span id="cb16-2"><a href="conditional-unconfoundedness-assumption.html#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="conditional-unconfoundedness-assumption.html#cb16-3" aria-hidden="true" tabindex="-1"></a>store  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, reps) </span>
<span id="cb16-4"><a href="conditional-unconfoundedness-assumption.html#cb16-4" aria-hidden="true" tabindex="-1"></a>store2  <span class="ot">&lt;-</span> store </span>
<span id="cb16-5"><a href="conditional-unconfoundedness-assumption.html#cb16-5" aria-hidden="true" tabindex="-1"></a>store.reg  <span class="ot">&lt;-</span> store</span>
<span id="cb16-6"><a href="conditional-unconfoundedness-assumption.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="conditional-unconfoundedness-assumption.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>reps){</span>
<span id="cb16-8"><a href="conditional-unconfoundedness-assumption.html#cb16-8" aria-hidden="true" tabindex="-1"></a>    ATE.results  <span class="ot">&lt;-</span> <span class="fu">fun_ATE2</span>(<span class="at">N =</span> <span class="dv">20000</span>, <span class="at">tau =</span> <span class="dv">10</span>)</span>
<span id="cb16-9"><a href="conditional-unconfoundedness-assumption.html#cb16-9" aria-hidden="true" tabindex="-1"></a>    store[i] <span class="ot">&lt;-</span> ATE.results[[<span class="dv">3</span>]]</span>
<span id="cb16-10"><a href="conditional-unconfoundedness-assumption.html#cb16-10" aria-hidden="true" tabindex="-1"></a>    store2[i]  <span class="ot">&lt;-</span> ATE.results[[<span class="dv">4</span>]]</span>
<span id="cb16-11"><a href="conditional-unconfoundedness-assumption.html#cb16-11" aria-hidden="true" tabindex="-1"></a>    store.reg[i]  <span class="ot">&lt;-</span> ATE.results[[<span class="dv">5</span>]]</span>
<span id="cb16-12"><a href="conditional-unconfoundedness-assumption.html#cb16-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-13"><a href="conditional-unconfoundedness-assumption.html#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="conditional-unconfoundedness-assumption.html#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of tau_hat conditioned </span></span>
<span id="cb16-15"><a href="conditional-unconfoundedness-assumption.html#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(store, <span class="at">main =</span> <span class="st">&quot;tau hats conditioned&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="conditional-unconfoundedness-assumption.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The standard error from the conditioned approach is:&quot;</span>, <span class="fu">sd</span>(store)))</span></code></pre></div>
<pre><code>## [1] &quot;The standard error from the conditioned approach is: 0.0800134155821363&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="conditional-unconfoundedness-assumption.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(store2, <span class="at">main =</span> <span class="st">&quot;tau hats not conditioned&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<p>The estimate of ATT is much closer to the true parameter, 10, when conditioned upon the covariates as compared to an unconditional approach (ATT estimate = 19).
This example highlights the importance of conditioning on <span class="math inline">\(X\)</span>s when evaluating the treatment effects if the treatment assignment is correlated with the potential outcomes. In this case, Blacks and females are more likely to have higher scores in general even without the treatment and both of these subgroups are also more likely to be treated. Treatment is not only non-random but is systematically correlated with the outcomes.</p>
<p>Since we have full information on the treatment assignment mechanism, after conditioning for the covariates the treatment assignment is random. In other words, within Black vs. White race groups, for example, the treatment assignment is randomly allocated, which means that <span class="math inline">\(E(Y_i(0)| W_i = 1, X_i = x) = E(Y_i | W_i = 0, X_i = x)\)</span>. This allows estimation of ATE for each subgroup or strata. After estimating ATE for each strata, the ATEs are averaged using the sample size of the strata as weights.</p>
<p>One problem with the approach highlighted above is that in complex settings, with many determinants (multi-dimensionality) of treatment or in presence of continuous covariates, the sub-space required for the analyses highlighted above will be thinned out too soon. As an alternative, regression has been rigorously used as a tool-kit to control for covariates. While there are benefits of using a regression framework, it is noway a panacea. This is specifically true if the regression models are misspecified. Below we will use a misspecified version of the regression model to see if we can recover the treatment estimate close to the true value.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="conditional-unconfoundedness-assumption.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;ATE estimated from misspecified regression model:&quot;</span>, ATE2_results[[<span class="dv">5</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;ATE estimated from misspecified regression model: 14.3396219086081&quot;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="conditional-unconfoundedness-assumption.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The standard error is:&quot;</span>, <span class="fu">sd</span>(store.reg)))</span></code></pre></div>
<pre><code>## [1] &quot;The standard error is: 0.181917650237595&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="conditional-unconfoundedness-assumption.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(store.reg, <span class="at">main =</span> <span class="st">&quot;Treatment effects using regression&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="an-estimation-example.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discussion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
