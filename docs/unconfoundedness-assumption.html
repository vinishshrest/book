<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2.6 Unconfoundedness assumption | Causal Inference</title>
  <meta name="description" content="2.6 Unconfoundedness assumption | Causal Inference" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="2.6 Unconfoundedness assumption | Causal Inference" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2.6 Unconfoundedness assumption | Causal Inference" />
  
  
  

<meta name="author" content="Vinish Shrestha" />


<meta name="date" content="2025-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="an-estimation-example.html"/>
<link rel="next" href="discussion.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="assets/kePrint-0.0.1/kePrint.js"></script>
<link href="assets/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Work in Progress</a></li>
<li class="chapter" data-level="2" data-path="causal-inference-an-introduction.html"><a href="causal-inference-an-introduction.html"><i class="fa fa-check"></i><b>2</b> Causal Inference: An Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="potential-outcome-framework-neyman-rubin-causal-model.html"><a href="potential-outcome-framework-neyman-rubin-causal-model.html"><i class="fa fa-check"></i><b>2.1</b> Potential Outcome Framework: Neyman-Rubin Causal Model</a></li>
<li class="chapter" data-level="2.2" data-path="average-treatment-effect-ate.html"><a href="average-treatment-effect-ate.html"><i class="fa fa-check"></i><b>2.2</b> Average treatment effect (ATE)</a></li>
<li class="chapter" data-level="2.3" data-path="rct.html"><a href="rct.html"><i class="fa fa-check"></i><b>2.3</b> RCT</a></li>
<li class="chapter" data-level="2.4" data-path="average-treatment-effect-on-the-treated-att.html"><a href="average-treatment-effect-on-the-treated-att.html"><i class="fa fa-check"></i><b>2.4</b> Average treatment effect on the treated (ATT)</a></li>
<li class="chapter" data-level="2.5" data-path="an-estimation-example.html"><a href="an-estimation-example.html"><i class="fa fa-check"></i><b>2.5</b> An estimation example</a></li>
<li class="chapter" data-level="2.6" data-path="unconfoundedness-assumption.html"><a href="unconfoundedness-assumption.html"><i class="fa fa-check"></i><b>2.6</b> Unconfoundedness assumption</a></li>
<li class="chapter" data-level="2.7" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>2.7</b> Discussion</a></li>
<li class="chapter" data-level="2.8" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>2.8</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ipw-and-aipw.html"><a href="ipw-and-aipw.html"><i class="fa fa-check"></i><b>3</b> IPW and AIPW</a>
<ul>
<li class="chapter" data-level="3.1" data-path="a-simple-example.html"><a href="a-simple-example.html"><i class="fa fa-check"></i><b>3.1</b> A simple example</a></li>
<li class="chapter" data-level="3.2" data-path="aggregated-estimator.html"><a href="aggregated-estimator.html"><i class="fa fa-check"></i><b>3.2</b> Aggregated Estimator</a></li>
<li class="chapter" data-level="3.3" data-path="propensity-score.html"><a href="propensity-score.html"><i class="fa fa-check"></i><b>3.3</b> Propensity score</a></li>
<li class="chapter" data-level="3.4" data-path="estimation-of-propensity-score.html"><a href="estimation-of-propensity-score.html"><i class="fa fa-check"></i><b>3.4</b> Estimation of propensity score</a></li>
<li class="chapter" data-level="3.5" data-path="using-cross-fitting-to-predict-propensity-score.html"><a href="using-cross-fitting-to-predict-propensity-score.html"><i class="fa fa-check"></i><b>3.5</b> Using cross-fitting to predict propensity score</a></li>
<li class="chapter" data-level="3.6" data-path="propensity-score-stratification.html"><a href="propensity-score-stratification.html"><i class="fa fa-check"></i><b>3.6</b> Propensity score stratification</a></li>
<li class="chapter" data-level="3.7" data-path="inverse-probability-weighting-ipw.html"><a href="inverse-probability-weighting-ipw.html"><i class="fa fa-check"></i><b>3.7</b> Inverse Probability Weighting (IPW)</a></li>
<li class="chapter" data-level="3.8" data-path="comparing-ipw-with-aggregated-estimate.html"><a href="comparing-ipw-with-aggregated-estimate.html"><i class="fa fa-check"></i><b>3.8</b> Comparing IPW with Aggregated Estimate</a></li>
<li class="chapter" data-level="3.9" data-path="aipw-and-estimation.html"><a href="aipw-and-estimation.html"><i class="fa fa-check"></i><b>3.9</b> AIPW and Estimation</a></li>
<li class="chapter" data-level="3.10" data-path="assessing-balance.html"><a href="assessing-balance.html"><i class="fa fa-check"></i><b>3.10</b> Assessing Balance</a></li>
<li class="chapter" data-level="3.11" data-path="cross-fitting.html"><a href="cross-fitting.html"><i class="fa fa-check"></i><b>3.11</b> Cross-fitting</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="difference-in-differences.html"><a href="difference-in-differences.html"><i class="fa fa-check"></i><b>4</b> Difference in Differences</a>
<ul>
<li class="chapter" data-level="4.1" data-path="a-quick-introduction.html"><a href="a-quick-introduction.html"><i class="fa fa-check"></i><b>4.1</b> A Quick Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i><b>4.2</b> Set up</a></li>
<li class="chapter" data-level="4.3" data-path="an-example-evaluating-the-impact-of-medicaid-expansion-on-uninsured-rate.html"><a href="an-example-evaluating-the-impact-of-medicaid-expansion-on-uninsured-rate.html"><i class="fa fa-check"></i><b>4.3</b> An example: Evaluating the impact of Medicaid expansion on uninsured rate</a></li>
<li class="chapter" data-level="4.4" data-path="naive-estimator.html"><a href="naive-estimator.html"><i class="fa fa-check"></i><b>4.4</b> Naive estimator</a></li>
<li class="chapter" data-level="4.5" data-path="canonical-difference-in-differences-framework.html"><a href="canonical-difference-in-differences-framework.html"><i class="fa fa-check"></i><b>4.5</b> Canonical Difference in Differences Framework</a></li>
<li class="chapter" data-level="4.6" data-path="did-in-multi-period-set-up.html"><a href="did-in-multi-period-set-up.html"><i class="fa fa-check"></i><b>4.6</b> DiD in multi-period set up</a></li>
<li class="chapter" data-level="4.7" data-path="conditional-parallel-trend-assumption.html"><a href="conditional-parallel-trend-assumption.html"><i class="fa fa-check"></i><b>4.7</b> Conditional Parallel Trend Assumption</a></li>
<li class="chapter" data-level="4.8" data-path="some-concerns-with-controls.html"><a href="some-concerns-with-controls.html"><i class="fa fa-check"></i><b>4.8</b> Some concerns with controls</a></li>
<li class="chapter" data-level="4.9" data-path="the-2-times-2-difference-in-differences-estimate.html"><a href="the-2-times-2-difference-in-differences-estimate.html"><i class="fa fa-check"></i><b>4.9</b> The <span class="math inline">\(2 \times 2\)</span> Difference-in-Differences Estimate</a></li>
<li class="chapter" data-level="4.10" data-path="event-study-model.html"><a href="event-study-model.html"><i class="fa fa-check"></i><b>4.10</b> Event study model</a></li>
<li class="chapter" data-level="4.11" data-path="two-way-fixed-effect-twfe-revisited.html"><a href="two-way-fixed-effect-twfe-revisited.html"><i class="fa fa-check"></i><b>4.11</b> Two way fixed effect (TWFE) Revisited</a></li>
<li class="chapter" data-level="4.12" data-path="various-ways-of-estimation.html"><a href="various-ways-of-estimation.html"><i class="fa fa-check"></i><b>4.12</b> Various ways of estimation</a></li>
<li class="chapter" data-level="4.13" data-path="multi-period-multi-group-and-variation-in-treatment-timing.html"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html"><i class="fa fa-check"></i><b>4.13</b> Multi Period, Multi Group and Variation in Treatment Timing</a></li>
<li class="chapter" data-level="4.14" data-path="problem-with-twfe-in-multiple-group-with-treatment-timing-variation.html"><a href="problem-with-twfe-in-multiple-group-with-treatment-timing-variation.html"><i class="fa fa-check"></i><b>4.14</b> Problem with TWFE in Multiple Group with Treatment Timing Variation</a></li>
<li class="chapter" data-level="4.15" data-path="what-is-twfe-estimating-when-there-is-treatment-timing-variation.html"><a href="what-is-twfe-estimating-when-there-is-treatment-timing-variation.html"><i class="fa fa-check"></i><b>4.15</b> What is TWFE Estimating when there is Treatment Timing Variation?</a></li>
<li class="chapter" data-level="4.16" data-path="assumptions-governing-twfedd-estimate.html"><a href="assumptions-governing-twfedd-estimate.html"><i class="fa fa-check"></i><b>4.16</b> Assumptions governing TWFEDD estimate</a></li>
<li class="chapter" data-level="4.17" data-path="how-does-treatment-effect-heterogeneity-in-time-affect-twfe.html"><a href="how-does-treatment-effect-heterogeneity-in-time-affect-twfe.html"><i class="fa fa-check"></i><b>4.17</b> How Does Treatment Effect Heterogeneity in Time Affect TWFE?</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="causal-forest.html"><a href="causal-forest.html"><i class="fa fa-check"></i><b>5</b> Causal Forest</a>
<ul>
<li class="chapter" data-level="5.1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="summary-of-grf.html"><a href="summary-of-grf.html"><i class="fa fa-check"></i><b>5.2</b> Summary of GRF</a></li>
<li class="chapter" data-level="5.3" data-path="motivation-for-causal-forests.html"><a href="motivation-for-causal-forests.html"><i class="fa fa-check"></i><b>5.3</b> Motivation for Causal Forests</a></li>
<li class="chapter" data-level="5.4" data-path="causal-forest-1.html"><a href="causal-forest-1.html"><i class="fa fa-check"></i><b>5.4</b> Causal Forest</a></li>
<li class="chapter" data-level="5.5" data-path="an-example-of-causal-forest.html"><a href="an-example-of-causal-forest.html"><i class="fa fa-check"></i><b>5.5</b> An example of causal forest</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="heterogeneous-treatment-effects.html"><a href="heterogeneous-treatment-effects.html"><i class="fa fa-check"></i><b>6</b> Heterogeneous Treatment Effects</a>
<ul>
<li class="chapter" data-level="6.1" data-path="some-ways-to-estimate-cate.html"><a href="some-ways-to-estimate-cate.html"><i class="fa fa-check"></i><b>6.1</b> Some ways to estimate CATE</a></li>
<li class="chapter" data-level="6.2" data-path="estimation.html"><a href="estimation.html"><i class="fa fa-check"></i><b>6.2</b> Estimation</a></li>
<li class="chapter" data-level="6.3" data-path="some-remarks-and-questions.html"><a href="some-remarks-and-questions.html"><i class="fa fa-check"></i><b>6.3</b> Some Remarks and Questions</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="unconfoundedness-assumption" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Unconfoundedness assumption<a href="unconfoundedness-assumption.html#unconfoundedness-assumption" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Most of the time the treatment assignment may not be fully random but can be driven by some selective covariates. Referring to the tutoring example, it may be unethical to disallow someone in the control group who wants to attend the tutoring sessions. As such, tutoring sessions may be voluntarily held, where students can select whether to attend the session.</p>
<p>Say, females and Blacks are more likely to attend the tutoring session and both of these variables are also likely to yield higher potential outcome. This means that females and Blacks are more likely to have higher exam score in absence of the treatment compared to males and Whites. It is easy to see that the treatment assignment is correlated with the potential outcomes and the <strong>independence assumption</strong> is violated. This is true in many cases of observational settings and even in randomized experiments. We require adjustments before being able to estimate treatment effects in such cases.</p>
<p>If we understand the treatment mechanism fairly well then we can still proceed further to estimate the treatment effects. For example, suppose the treatment assignment is (voluntarily)
more tilted towards females than males and Blacks than Whites. In this case, we would want to invoke unconfoundedness (<strong>conditional independence</strong>) assumption.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> Formally, this states that <span class="math inline">\(Y_i(0), \; Y_i(1) \perp W_i | X_i\)</span>. This means that conditional upon the covariates the treatment assignment is random.</p>
<p>To estimate ATT one would want to first estimate ATT within each strata: <span class="math inline">\(i)\)</span> female-Black, <span class="math inline">\(ii)\)</span> female-White, <span class="math inline">\(iii)\)</span> male-Black, and <span class="math inline">\(iv)\)</span> male-White, and take a weighted average of the strata-specific ATEs by using the proportion of the sample in the given strata as weights. The conditional independence assumption means that within each strata treatment assignment is random. The following code first estimates the strata specific ATTs and then summarizes them using the weighted average. Note that the true treatment effect is 10.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="unconfoundedness-assumption.html#cb10-1" aria-hidden="true" tabindex="-1"></a> fun_ATE2  <span class="ot">&lt;-</span> <span class="cf">function</span>(N, tau){</span>
<span id="cb10-2"><a href="unconfoundedness-assumption.html#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="unconfoundedness-assumption.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># @arg tau: true treatment effect</span></span>
<span id="cb10-4"><a href="unconfoundedness-assumption.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># @arg N:   sample size</span></span>
<span id="cb10-5"><a href="unconfoundedness-assumption.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Return tau_hat: estimate of the treatment effect using conditional randomness assumption   </span></span>
<span id="cb10-6"><a href="unconfoundedness-assumption.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Return tau_hat2: estimate of the treatment effect wrongly using unconditional independence assumption</span></span>
<span id="cb10-7"><a href="unconfoundedness-assumption.html#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Return reg_tau: estimate from conditioning using regression but from a misspecified model</span></span>
<span id="cb10-8"><a href="unconfoundedness-assumption.html#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="unconfoundedness-assumption.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create pseudo data</span></span>
<span id="cb10-10"><a href="unconfoundedness-assumption.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    gender  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb10-11"><a href="unconfoundedness-assumption.html#cb10-11" aria-hidden="true" tabindex="-1"></a>    race  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.5</span>)</span>
<span id="cb10-12"><a href="unconfoundedness-assumption.html#cb10-12" aria-hidden="true" tabindex="-1"></a>    W  <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(N, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="fl">0.2</span> <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> (gender <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> (race <span class="sc">&gt;</span> <span class="dv">0</span>))    </span>
<span id="cb10-13"><a href="unconfoundedness-assumption.html#cb10-13" aria-hidden="true" tabindex="-1"></a>    Y  <span class="ot">&lt;-</span> <span class="dv">40</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> W  <span class="sc">+</span> gender <span class="sc">*</span> <span class="dv">2</span> <span class="sc">+</span> race <span class="sc">*</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">25</span> <span class="sc">*</span> race <span class="sc">*</span> gender <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb10-14"><a href="unconfoundedness-assumption.html#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="unconfoundedness-assumption.html#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># female-Blacks</span></span>
<span id="cb10-16"><a href="unconfoundedness-assumption.html#cb10-16" aria-hidden="true" tabindex="-1"></a>    tau_hat1  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) </span>
<span id="cb10-17"><a href="unconfoundedness-assumption.html#cb10-17" aria-hidden="true" tabindex="-1"></a>    w1  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb10-18"><a href="unconfoundedness-assumption.html#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="unconfoundedness-assumption.html#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># female-Whites</span></span>
<span id="cb10-20"><a href="unconfoundedness-assumption.html#cb10-20" aria-hidden="true" tabindex="-1"></a>    tau_hat2  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) </span>
<span id="cb10-21"><a href="unconfoundedness-assumption.html#cb10-21" aria-hidden="true" tabindex="-1"></a>    w2  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> N</span>
<span id="cb10-22"><a href="unconfoundedness-assumption.html#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="unconfoundedness-assumption.html#cb10-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># male-Blacks</span></span>
<span id="cb10-24"><a href="unconfoundedness-assumption.html#cb10-24" aria-hidden="true" tabindex="-1"></a>    tau_hat3  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>)]) </span>
<span id="cb10-25"><a href="unconfoundedness-assumption.html#cb10-25" aria-hidden="true" tabindex="-1"></a>    w3  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">/</span> N</span>
<span id="cb10-26"><a href="unconfoundedness-assumption.html#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="unconfoundedness-assumption.html#cb10-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># male-Whites</span></span>
<span id="cb10-28"><a href="unconfoundedness-assumption.html#cb10-28" aria-hidden="true" tabindex="-1"></a>    tau_hat4  <span class="ot">&lt;-</span>  <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) <span class="sc">-</span> <span class="fu">mean</span>(Y[<span class="fu">which</span>(W <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>)]) </span>
<span id="cb10-29"><a href="unconfoundedness-assumption.html#cb10-29" aria-hidden="true" tabindex="-1"></a>    w4  <span class="ot">&lt;-</span> <span class="fu">sum</span>(gender <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> race <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">/</span> N</span>
<span id="cb10-30"><a href="unconfoundedness-assumption.html#cb10-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-31"><a href="unconfoundedness-assumption.html#cb10-31" aria-hidden="true" tabindex="-1"></a>    tau_hat  <span class="ot">&lt;-</span> tau_hat1 <span class="sc">*</span> w1 <span class="sc">+</span> tau_hat2 <span class="sc">*</span> w2 <span class="sc">+</span> tau_hat3 <span class="sc">*</span> w3 <span class="sc">+</span> tau_hat4 <span class="sc">*</span> w4</span>
<span id="cb10-32"><a href="unconfoundedness-assumption.html#cb10-32" aria-hidden="true" tabindex="-1"></a>    tau_hat2  <span class="ot">&lt;-</span> <span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">1</span>]) <span class="sc">-</span> <span class="fu">mean</span>(Y[W <span class="sc">==</span> <span class="dv">0</span>])</span>
<span id="cb10-33"><a href="unconfoundedness-assumption.html#cb10-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-34"><a href="unconfoundedness-assumption.html#cb10-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a mis-specified regression model</span></span>
<span id="cb10-35"><a href="unconfoundedness-assumption.html#cb10-35" aria-hidden="true" tabindex="-1"></a>    reg  <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> W <span class="sc">+</span> gender)</span>
<span id="cb10-36"><a href="unconfoundedness-assumption.html#cb10-36" aria-hidden="true" tabindex="-1"></a>    reg_tau  <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(reg)[[<span class="dv">2</span>]]</span>
<span id="cb10-37"><a href="unconfoundedness-assumption.html#cb10-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-38"><a href="unconfoundedness-assumption.html#cb10-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">table</span>(gender[W <span class="sc">==</span> <span class="dv">1</span>]), <span class="fu">table</span>(race[W <span class="sc">==</span> <span class="dv">1</span>]), tau_hat, tau_hat2, reg_tau))</span>
<span id="cb10-39"><a href="unconfoundedness-assumption.html#cb10-39" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-40"><a href="unconfoundedness-assumption.html#cb10-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-41"><a href="unconfoundedness-assumption.html#cb10-41" aria-hidden="true" tabindex="-1"></a>ATE2_results  <span class="ot">&lt;-</span> <span class="fu">fun_ATE2</span>(<span class="at">N =</span> <span class="dv">20000</span>, <span class="at">tau =</span> <span class="dv">10</span>)</span>
<span id="cb10-42"><a href="unconfoundedness-assumption.html#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;treated males: &quot;</span>, <span class="st">&quot;treated females: &quot;</span>) , ATE2_results[[<span class="dv">1</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;treated males:  2983&quot;   &quot;treated females:  7102&quot;</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="unconfoundedness-assumption.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;treated Whites: &quot;</span>, <span class="st">&quot;treated Blacks: &quot;</span>) , ATE2_results[[<span class="dv">2</span>]])) </span></code></pre></div>
<pre><code>## [1] &quot;treated Whites:  4065&quot; &quot;treated Blacks:  6020&quot;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="unconfoundedness-assumption.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;ATE conditioned on Xs is :&quot;</span>, ATE2_results[[<span class="dv">3</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;ATE conditioned on Xs is : 9.91834954520539&quot;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="unconfoundedness-assumption.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;ATE not conditioned on Xs is :&quot;</span>, ATE2_results[[<span class="dv">4</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;ATE not conditioned on Xs is : 19.2941642000187&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="unconfoundedness-assumption.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get tau_hats from replications </span></span>
<span id="cb18-2"><a href="unconfoundedness-assumption.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="unconfoundedness-assumption.html#cb18-3" aria-hidden="true" tabindex="-1"></a>store  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, reps) </span>
<span id="cb18-4"><a href="unconfoundedness-assumption.html#cb18-4" aria-hidden="true" tabindex="-1"></a>store2  <span class="ot">&lt;-</span> store </span>
<span id="cb18-5"><a href="unconfoundedness-assumption.html#cb18-5" aria-hidden="true" tabindex="-1"></a>store.reg  <span class="ot">&lt;-</span> store</span>
<span id="cb18-6"><a href="unconfoundedness-assumption.html#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="unconfoundedness-assumption.html#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>reps){</span>
<span id="cb18-8"><a href="unconfoundedness-assumption.html#cb18-8" aria-hidden="true" tabindex="-1"></a>    ATE.results  <span class="ot">&lt;-</span> <span class="fu">fun_ATE2</span>(<span class="at">N =</span> <span class="dv">20000</span>, <span class="at">tau =</span> <span class="dv">10</span>)</span>
<span id="cb18-9"><a href="unconfoundedness-assumption.html#cb18-9" aria-hidden="true" tabindex="-1"></a>    store[i] <span class="ot">&lt;-</span> ATE.results[[<span class="dv">3</span>]]</span>
<span id="cb18-10"><a href="unconfoundedness-assumption.html#cb18-10" aria-hidden="true" tabindex="-1"></a>    store2[i]  <span class="ot">&lt;-</span> ATE.results[[<span class="dv">4</span>]]</span>
<span id="cb18-11"><a href="unconfoundedness-assumption.html#cb18-11" aria-hidden="true" tabindex="-1"></a>    store.reg[i]  <span class="ot">&lt;-</span> ATE.results[[<span class="dv">5</span>]]</span>
<span id="cb18-12"><a href="unconfoundedness-assumption.html#cb18-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-13"><a href="unconfoundedness-assumption.html#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="unconfoundedness-assumption.html#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of tau_hat conditioned </span></span>
<span id="cb18-15"><a href="unconfoundedness-assumption.html#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(store, <span class="at">main =</span> <span class="st">&quot;tau hats conditioned&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="unconfoundedness-assumption.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The standard error from the conditioned approach is:&quot;</span>, <span class="fu">sd</span>(store)))</span></code></pre></div>
<pre><code>## [1] &quot;The standard error from the conditioned approach is: 0.0814601250615582&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="unconfoundedness-assumption.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(store2, <span class="at">main =</span> <span class="st">&quot;tau hats not conditioned&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<p>The ATT estimate is much closer to the true parameter, 10, when conditioned upon the covariates as compared to an unconditional approach (where the distribution of ATT estimate is centered around 19.3).
This example highlights the importance of conditioning on <span class="math inline">\(X\)</span>s when evaluating the treatment effects if the treatment assignment is correlated with the potential outcomes. In this case, Blacks and females are more likely to have higher scores in general even without the treatment and both of these subgroups are also more likely to be treated. Treatment is not only non-random but is systematically correlated with the outcomes.</p>
<p>Since we have the perfect information on the treatment assignment mechanism, after conditioning for the covariates the treatment assignment is essentially random. In other words, within Black vs. White race groups, for example, the treatment assignment is randomly allocated. This allows estimation of ATE for each subgroup or strata. After estimating ATE for each strata, the ATEs are averaged using the sample size of the strata as weights.</p>
<p>One problem with the approach highlighted above is that in complex settings, with many determinants (multi-dimensionality) of treatment or in presence of continuous covariates, the sub-space required for the analyses highlighted above will be thinned out too soon. As an alternative, <strong>regression framework</strong> has been rigorously used as a tool-kit to control for covariates. While there are benefits of using a regression framework, it is by nomeans a panacea. This is especially true if the regression models are misspecified. Below we will use a misspecified version of the regression model to see if we can recover the treatment estimate close to the true value.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="unconfoundedness-assumption.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;ATE estimated from misspecified regression model:&quot;</span>, ATE2_results[[<span class="dv">5</span>]]))</span></code></pre></div>
<pre><code>## [1] &quot;ATE estimated from misspecified regression model: 14.1794224498239&quot;</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="unconfoundedness-assumption.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&quot;The standard error is:&quot;</span>, <span class="fu">sd</span>(store.reg)))</span></code></pre></div>
<pre><code>## [1] &quot;The standard error is: 0.182411808545127&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="unconfoundedness-assumption.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(store.reg, <span class="at">main =</span> <span class="st">&quot;Treatment effects using regression&quot;</span>)</span></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>The terms unconfoundedness and conditional independence (<span class="math inline">\(heart\; disease \perp age \; | \; cholestrol\)</span>) are used interchangebly in causal inference literature. Conditional independence is a broader term that relates to the general field of probability and statistics, whereas unconfoundedness is more specific to causal inference. Unconfoundedness implies a specific kind of conditional independence, specific to causal inference.<a href="unconfoundedness-assumption.html#fnref2" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="an-estimation-example.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="discussion.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
