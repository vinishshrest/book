<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Multi Period, Multi Group and Variation in Treatment Timing | Difference in Differences</title>
  <meta name="description" content="10 Multi Period, Multi Group and Variation in Treatment Timing | Difference in Differences" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Multi Period, Multi Group and Variation in Treatment Timing | Difference in Differences" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Multi Period, Multi Group and Variation in Treatment Timing | Difference in Differences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="various-ways-of-estimation.html"/>
<link rel="next" href="problem-with-twfe-in-multiple-group-with-treatment-timing-variation.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="a-quick-introduction.html"><a href="a-quick-introduction.html"><i class="fa fa-check"></i><b>1</b> A Quick Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i><b>1.1</b> Set up</a></li>
<li class="chapter" data-level="1.2" data-path="an-example-evaluating-the-impact-of-medicaid-expansion-on-uninsured-rate.html"><a href="an-example-evaluating-the-impact-of-medicaid-expansion-on-uninsured-rate.html"><i class="fa fa-check"></i><b>1.2</b> An example: Evaluating the impact of Medicaid expansion on uninsured rate</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="naive-estimator.html"><a href="naive-estimator.html"><i class="fa fa-check"></i><b>2</b> Naive estimator</a></li>
<li class="chapter" data-level="3" data-path="canonical-difference-in-differences-framework.html"><a href="canonical-difference-in-differences-framework.html"><i class="fa fa-check"></i><b>3</b> Canonical Difference in Differences Framework</a></li>
<li class="chapter" data-level="4" data-path="did-in-multi-period-set-up.html"><a href="did-in-multi-period-set-up.html"><i class="fa fa-check"></i><b>4</b> DiD in multi-period set up</a></li>
<li class="chapter" data-level="5" data-path="conditional-parallel-trend.html"><a href="conditional-parallel-trend.html"><i class="fa fa-check"></i><b>5</b> Conditional Parallel Trend</a>
<ul>
<li class="chapter" data-level="5.1" data-path="some-concerns-with-controls.html"><a href="some-concerns-with-controls.html"><i class="fa fa-check"></i><b>5.1</b> Some concerns with controls</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="the-2-times-2-difference-in-differences-estimate.html"><a href="the-2-times-2-difference-in-differences-estimate.html"><i class="fa fa-check"></i><b>6</b> The <span class="math inline">\(2 \times 2\)</span> Difference-in-Differences Estimate</a></li>
<li class="chapter" data-level="7" data-path="event-study-model.html"><a href="event-study-model.html"><i class="fa fa-check"></i><b>7</b> Event study model</a></li>
<li class="chapter" data-level="8" data-path="two-way-fixed-effect.html"><a href="two-way-fixed-effect.html"><i class="fa fa-check"></i><b>8</b> Two way fixed effect</a></li>
<li class="chapter" data-level="9" data-path="various-ways-of-estimation.html"><a href="various-ways-of-estimation.html"><i class="fa fa-check"></i><b>9</b> Various ways of estimation</a></li>
<li class="chapter" data-level="10" data-path="multi-period-multi-group-and-variation-in-treatment-timing.html"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html"><i class="fa fa-check"></i><b>10</b> Multi Period, Multi Group and Variation in Treatment Timing</a>
<ul>
<li class="chapter" data-level="10.1" data-path="problem-with-twfe-in-multiple-group-with-treatment-timing-variation.html"><a href="problem-with-twfe-in-multiple-group-with-treatment-timing-variation.html"><i class="fa fa-check"></i><b>10.1</b> Problem with TWFE in Multiple Group with Treatment Timing Variation</a></li>
<li class="chapter" data-level="10.2" data-path="what-is-twfe-estimating-when-there-is-treatment-timing-variation.html"><a href="what-is-twfe-estimating-when-there-is-treatment-timing-variation.html"><i class="fa fa-check"></i><b>10.2</b> What is TWFE Estimating when there is Treatment Timing Variation?</a></li>
<li class="chapter" data-level="10.3" data-path="assumptions-governing-twfedd-estimate.html"><a href="assumptions-governing-twfedd-estimate.html"><i class="fa fa-check"></i><b>10.3</b> Assumptions governing TWFEDD estimate</a></li>
<li class="chapter" data-level="10.4" data-path="how-does-treatment-effect-heterogeneity-in-time-affect-twfe.html"><a href="how-does-treatment-effect-heterogeneity-in-time-affect-twfe.html"><i class="fa fa-check"></i><b>10.4</b> How Does Treatment Effect Heterogeneity in Time Affect TWFE?</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Difference in Differences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="multi-period-multi-group-and-variation-in-treatment-timing" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Multi Period, Multi Group and Variation in Treatment Timing<a href="multi-period-multi-group-and-variation-in-treatment-timing.html#multi-period-multi-group-and-variation-in-treatment-timing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-1" aria-hidden="true" tabindex="-1"></a>trueeffect <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb61-2"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-2" aria-hidden="true" tabindex="-1"></a>intercep <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb61-3"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-3" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb61-4"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-4" aria-hidden="true" tabindex="-1"></a>T <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb61-5"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-5" aria-hidden="true" tabindex="-1"></a>early <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb61-6"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-6" aria-hidden="true" tabindex="-1"></a>late <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb61-7"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-8" aria-hidden="true" tabindex="-1"></a>datagen <span class="ot">&lt;-</span> <span class="cf">function</span>(T, N, group){</span>
<span id="cb61-9"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  timeT <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>T, <span class="at">each =</span> N)</span>
<span id="cb61-10"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-10" aria-hidden="true" tabindex="-1"></a>  treatT <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">length</span>(timeT))</span>
<span id="cb61-11"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-11" aria-hidden="true" tabindex="-1"></a>  groupT <span class="ot">&lt;-</span> <span class="fu">rep</span>(group, <span class="fu">length</span>(timeT))</span>
<span id="cb61-12"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-12" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> timeT, <span class="at">treat =</span> treatT, <span class="at">group =</span> groupT)</span>
<span id="cb61-13"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb61-14"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb61-15"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-16" aria-hidden="true" tabindex="-1"></a>dftreat <span class="ot">&lt;-</span> <span class="fu">datagen</span>(T, N, <span class="dv">1</span>) <span class="co"># early treatment</span></span>
<span id="cb61-17"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-17" aria-hidden="true" tabindex="-1"></a>dftreat2 <span class="ot">&lt;-</span> <span class="fu">datagen</span>(T, N, <span class="dv">2</span>) <span class="co"># late treatment</span></span>
<span id="cb61-18"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-18" aria-hidden="true" tabindex="-1"></a>dfuntreat <span class="ot">&lt;-</span> <span class="fu">datagen</span>(T, N, <span class="dv">3</span>) <span class="co"># untreated</span></span>
<span id="cb61-19"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-20" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(dftreat, dftreat2, dfuntreat)</span>
<span id="cb61-21"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="co"># generating policy variables </span></span>
<span id="cb61-23"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-23" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb61-24"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">policy =</span> <span class="dv">0</span>, <span class="at">policy =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> time <span class="sc">&gt;</span> early, <span class="dv">1</span>, policy), <span class="at">policy =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span> time <span class="sc">&gt;</span> late, <span class="dv">1</span>, policy),</span>
<span id="cb61-25"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">dumtreat1 =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">dumtreat2 =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>), <span class="at">dumtreat3 =</span> <span class="fu">ifelse</span>(group <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb61-26"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-27"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-27" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(data), <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb61-28"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-29"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-29" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="dv">1</span> <span class="sc">+</span> trueeffect<span class="sc">*</span>dumtreat1<span class="sc">*</span>policy <span class="sc">+</span> trueeffect<span class="sc">*</span>dumtreat2<span class="sc">*</span>policy <span class="sc">+</span> time <span class="sc">+</span> dumtreat1<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> dumtreat2<span class="sc">*</span><span class="dv">4</span> <span class="sc">+</span> e,</span>
<span id="cb61-30"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-30" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Ypot =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">*</span>dumtreat1<span class="sc">*</span>policy <span class="sc">+</span> <span class="dv">1</span><span class="sc">*</span>dumtreat2<span class="sc">*</span>policy <span class="sc">+</span> time <span class="sc">+</span> dumtreat1<span class="sc">*</span><span class="dv">2</span> <span class="sc">+</span> dumtreat2<span class="sc">*</span><span class="dv">4</span> <span class="sc">+</span> e)</span>
<span id="cb61-31"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-32"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-32" aria-hidden="true" tabindex="-1"></a>datasum <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(data <span class="sc">%&gt;%</span></span>
<span id="cb61-33"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">group_by</span>(group, time) <span class="sc">%&gt;%</span></span>
<span id="cb61-34"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">summarise</span>(<span class="at">meanY =</span> <span class="fu">mean</span>(Y), <span class="at">meanYpot =</span> <span class="fu">mean</span>(Ypot))</span>
<span id="cb61-35"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb61-35" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;group&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data for potential outcome</span></span>
<span id="cb63-2"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-2" aria-hidden="true" tabindex="-1"></a>datasumpot <span class="ot">&lt;-</span> datasum <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(group, time, meanYpot)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">mutate</span>(<span class="at">group =</span> <span class="dv">10</span><span class="sc">*</span>group)</span>
<span id="cb63-4"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-4" aria-hidden="true" tabindex="-1"></a>datasum <span class="ot">&lt;-</span> datasum <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(meanYpot))</span>
<span id="cb63-5"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(datasumpot) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;group&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;meanY&quot;</span>)</span>
<span id="cb63-6"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-7" aria-hidden="true" tabindex="-1"></a>datasum <span class="ot">&lt;-</span> <span class="fu">rbind</span>(datasum, datasumpot)</span>
<span id="cb63-8"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-9" aria-hidden="true" tabindex="-1"></a>vlines <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xint =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">16</span>))</span>
<span id="cb63-10"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-11" aria-hidden="true" tabindex="-1"></a>datasum<span class="sc">$</span>group <span class="ot">=</span> <span class="fu">factor</span>(datasum<span class="sc">$</span>group)</span>
<span id="cb63-12"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datasum, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> meanY, <span class="at">group =</span> group)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">linetype =</span> group, <span class="at">color =</span> group),<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> <span class="co">#geom_point(aes(shape = group, size = 3)) + </span></span>
<span id="cb63-13"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_linetype_manual</span>(<span class="at">name =</span> <span class="st">&quot;Linetype&quot;</span>,<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;1&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;2&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;3&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;10&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;20&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;30&quot;</span> <span class="ot">=</span> <span class="dv">2</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb63-14"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb63-15"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="at">panel.background =</span> <span class="fu">element_blank</span>(), <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>), <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;period&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Outcome&quot;</span>) <span class="sc">+</span> </span>
<span id="cb63-16"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_vline</span>(<span class="at">data =</span> vlines, <span class="fu">aes</span>(<span class="at">xintercept =</span> xint), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb63-17"><a href="multi-period-multi-group-and-variation-in-treatment-timing.html#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="fu">annotate</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">5.2</span>, <span class="fl">15.2</span>, <span class="dv">2</span>, <span class="dv">9</span>, <span class="dv">17</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">35</span>, <span class="dv">35</span>, <span class="dv">35</span>), <span class="at">label =</span> <span class="fu">c</span>(<span class="fu">bquote</span>(t[k]<span class="sc">^</span><span class="st">&quot;*&quot;</span>), <span class="fu">bquote</span>(t[l]<span class="sc">^</span><span class="st">&quot;*&quot;</span>), <span class="st">&quot;PRE(k)&quot;</span>, <span class="st">&quot;MID(k,l)&quot;</span>, <span class="st">&quot;POST(l)&quot;</span>), <span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">parse =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## i Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<p><img src="did_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>The figure above depicts the case of three groups: <span class="math inline">\(i)\)</span> early treated (treatment starting from the <span class="math inline">\(6^{th}\)</span> period, <span class="math inline">\(t_{k}^{*}\)</span>);
<span class="math inline">\(ii)\)</span> late treated (<span class="math inline">\(16^{th}\)</span> period, <span class="math inline">\(t_{k}^{*}\)</span>); and untreated group. The figure provides an example of staggered treatment adoption.
This means that units are treated at different points in time and once treated they are always treated.
The solid lines represent observed outcomes, whereas the dotted lines are the potential outcomes. For the untreated
group and not yet treated periods the observed outcomes are also the potential outcomes.</p>
<p>To go further, letâ€™s introduce some notations.</p>
<ul>
<li><em><span class="math inline">\(T\)</span></em> is defined as the number of periods.<br />
</li>
<li>Groups are defined based on the timing of the treatment of the unit. <em><span class="math inline">\(G_{i}\)</span></em> indicates the group of the unit and
all set of groups include <span class="math inline">\(\zeta \in \{2,\; ...., T,\;T+1\}\)</span>. Units that are treated in period 1 are dropped in this setup.
One reason to do so is that no pretreatment outcomes are observed for this group, which means that it is not possible to
use the parallel trend assumption. <em>T+1</em> group is used to denote units that remain untreated throughout the period
(never treated group). It is possible that eventually all units are treated. In this case, one can limit the data to time
period with not yet treated group.<br />
</li>
<li><span class="math inline">\(Y_{it}(g)\)</span> is denoted as the outcome of unit <span class="math inline">\(i\)</span> observed at time <span class="math inline">\(t\)</span> when the unit was treated in period <span class="math inline">\(g\)</span>.</li>
<li><span class="math inline">\(Y_{it}(0)\)</span> is the potential outcome of unit <span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span> had the unit not been treated.</li>
</ul>
<p>There are a few assumptions that we need to consider. There are more assumputions highlighted in <span class="citation">(<a href="#ref-callaway2022" role="doc-biblioref"><strong>callaway2022?</strong></a>)</span> paper. But
I will focus on two main ones.</p>
<p><em>Staggered Treatment Assignment.</em> For all units and for all <span class="math inline">\(t = 2,\;3,...,\;T\)</span>, <span class="math inline">\(D_{it-1}=1\)</span> implies <span class="math inline">\(D_{it}=1\)</span>. This
means that once a unit is treated, it remains treated.</p>
<p><em>Parallel Trend Assumption for Multi Period and Variation in Treatment Timing.</em> For all <span class="math inline">\(t = 2,\;3,...,\;T\)</span></p>
<p><span class="math display">\[\begin{equation}
E[\Delta Y_{it}(0)|G=g]=E[\Delta Y_{it}(0)]
\end{equation}\]</span></p>
<p>This basically says that the average pathway of group g if it was untreated
(potential outcome) would be same as the average pathway of other group (untreated) for each time period. This holds for
each group <span class="math inline">\(g \in \zeta\)</span>.
In other words, this can be thought as an extension of the parallel trend assumption for <span class="math inline">\(2 \times 2\)</span>, but in this case
it should hold for each <span class="math inline">\(g \in \zeta\)</span> and for each time period <span class="math inline">\(t\)</span>.
The parallel trend described in the assumption above is highly general, meaning that it assumes parallel trends for any groups.
However, this may not be the case as groups can be very different in observed characteristics and can have different pathways
in absence of the treatment.
Hence, there are other versions of parallel trend assumption to consider:</p>
<pre><code>a. parallel trend holds only for groups with similar observed characteristics 
b. parallel trend holds only for certain time periods 
c. parallel trend holds only for those group who ever participate in the treatment </code></pre>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="various-ways-of-estimation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="problem-with-twfe-in-multiple-group-with-treatment-timing-variation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
