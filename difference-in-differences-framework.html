<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Difference in Differences Framework | Difference in Differences</title>
  <meta name="description" content="3 Difference in Differences Framework | Difference in Differences" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Difference in Differences Framework | Difference in Differences" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Difference in Differences Framework | Difference in Differences" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="naive-estimator.html"/>
<link rel="next" href="evidence-regarding-parallel-trend.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="an-example.html"><a href="an-example.html"><i class="fa fa-check"></i><b>1</b> An example</a></li>
<li class="chapter" data-level="2" data-path="naive-estimator.html"><a href="naive-estimator.html"><i class="fa fa-check"></i><b>2</b> Naive estimator</a></li>
<li class="chapter" data-level="3" data-path="difference-in-differences-framework.html"><a href="difference-in-differences-framework.html"><i class="fa fa-check"></i><b>3</b> Difference in Differences Framework</a></li>
<li class="chapter" data-level="4" data-path="evidence-regarding-parallel-trend.html"><a href="evidence-regarding-parallel-trend.html"><i class="fa fa-check"></i><b>4</b> Evidence regarding parallel trend</a></li>
<li class="chapter" data-level="5" data-path="conditional-pta.html"><a href="conditional-pta.html"><i class="fa fa-check"></i><b>5</b> Conditional PTA</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Difference in Differences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="difference-in-differences-framework" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Difference in Differences Framework<a href="difference-in-differences-framework.html#difference-in-differences-framework" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>We would like to alleviate the aforementioned concerns. One way to address the second concern, i.e., outcomes in pre-treatment period may differ significantly between the treatment and control groups, is to take out the mean difference in outcome during the pre-treatment period from the mean difference in outcome post treatment.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="difference-in-differences-framework.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(naive <span class="sc">-</span> naive_pre)</span></code></pre></div>
<pre><code>## [1] -7.644971</code></pre>
<p>This suggests that uninsured rate dropped by 7.65 percentage points following the Medicaid expansion. This defines the term “difference-in-differences” as it involves two differences in means across the treatment and control group; one post treatment and the other difference prior to the treatment.</p>
<p>Let’s formally visit the DiD approach. The ATT is given as:</p>
<p><span class="math display" id="eq:att">\[\begin{equation}
\tau = E(Y^1(1) - Y^0(1)| D = 1) \tag{3.1}
\end{equation}\]</span></p>
<p>Here, <span class="math inline">\(Y^1(1)\)</span> is the outcome following the treatment, and <span class="math inline">\(Y^0(0)\)</span> is the counterfactual, i.e., the outcome without the treatment. <span class="math inline">\(E(Y^0(1)|1)\)</span>, which is the conditional mean outcome of the treatment group in absence of the treatment, is not revealed as it is the counterfactual and our job still remains to come up with a valid counterfactual.</p>
<p>Let’s plot the mean uninsured rate over time across the treatment versus the control groups.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="difference-in-differences-framework.html#cb19-1" aria-hidden="true" tabindex="-1"></a>dat_sum  <span class="ot">&lt;-</span> mort_allcauses  <span class="sc">%&gt;%</span>  </span>
<span id="cb19-2"><a href="difference-in-differences-framework.html#cb19-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(year, expand)  <span class="sc">%&gt;%</span>  </span>
<span id="cb19-3"><a href="difference-in-differences-framework.html#cb19-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarize</span>(<span class="at">uninsured =</span> <span class="fu">mean</span>(sahieunins138))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;year&#39;. You can override using the
## `.groups` argument.</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="difference-in-differences-framework.html#cb21-1" aria-hidden="true" tabindex="-1"></a>post_cf_treat  <span class="ot">&lt;-</span> dat_sum<span class="sc">$</span>uninsured[dat_sum<span class="sc">$</span>expand <span class="sc">==</span> <span class="dv">0</span>] <span class="sc">+</span> naive_pre</span>
<span id="cb21-2"><a href="difference-in-differences-framework.html#cb21-2" aria-hidden="true" tabindex="-1"></a>dat_treat_cf  <span class="ot">&lt;-</span>  <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="dv">2010</span>, <span class="dv">2017</span>, <span class="dv">1</span>), <span class="at">expand =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>), <span class="at">cf =</span> post_cf_treat)</span>
<span id="cb21-3"><a href="difference-in-differences-framework.html#cb21-3" aria-hidden="true" tabindex="-1"></a>dat_sum  <span class="ot">&lt;-</span> dat_sum  <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="difference-in-differences-framework.html#cb21-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">left_join</span>(dat_treat_cf, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;expand&quot;</span>))</span>
<span id="cb21-5"><a href="difference-in-differences-framework.html#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="difference-in-differences-framework.html#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_sum, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> uninsured, <span class="at">group =</span> <span class="fu">as.factor</span>(expand), <span class="at">color =</span> <span class="fu">as.factor</span>(expand)), <span class="at">shape =</span> <span class="fu">as.factor</span>(expand)) <span class="sc">+</span> </span>
<span id="cb21-7"><a href="difference-in-differences-framework.html#cb21-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb21-8"><a href="difference-in-differences-framework.html#cb21-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2014</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span> </span>
<span id="cb21-9"><a href="difference-in-differences-framework.html#cb21-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="at">data =</span> dat_sum, </span>
<span id="cb21-10"><a href="difference-in-differences-framework.html#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">aes</span>(<span class="at">y =</span> cf), </span>
<span id="cb21-11"><a href="difference-in-differences-framework.html#cb21-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, </span>
<span id="cb21-12"><a href="difference-in-differences-framework.html#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> <span class="st">&quot;lightblue&quot;</span>, </span>
<span id="cb21-13"><a href="difference-in-differences-framework.html#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## i Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
## generated.</code></pre>
<pre><code>## Warning: Removed 8 rows containing missing values or values outside the scale range
## (`geom_line()`).</code></pre>
<p><img src="did_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The plot shows that uninsured rate trended parallelly between the treated and control groups prior to the expansion. The rates dropped following the
expansion year (2014) across both the treated and control groups, but the magnitude of drop in uninsured rate is higher for the treated group.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> What we are doing in DiD is using the control group as the counterfactual for the treated group. In other words, we are assuming that in absence of the treatment, outcome for the treated group would have evolved similarly to that of the control group. This is the key assumption of DiD, which is also known as the parallel trend assumption. Note that, once we difference out the pre-treatment means between the treated and controls groups, we obtain the dashed line, which is the counterfactual for the treated group. In this case, the counterfactual line overlaps the average outcome for the treated group given the parallel trends in outcomes prior to the treatment. Loosely speaking, ATT is the gap between the outcome for the treated group and the counterfactual outcome during the post-treatment period.</p>
<p>Let’s consider the classic case of DiD with two groups (treatment &amp; control) and two periods (before and after treatment).
Formally the parallel trend assumption is given as:</p>
<p><span class="math display" id="eq:ptrend1">\[\begin{equation}
E(Y^0(1) - Y^0(0)| D = 1) = E(Y^0(1) - Y^0(0)| D = 0)  \tag{3.2}
\end{equation}\]</span></p>
<p>Here, we have written the parallel trend assumption using the potential outcomes. <span class="math inline">\(Y^0(1)\)</span> is the potential outcome in the post-treatment period in absence of the treatment, <span class="math inline">\(Y^0(0)\)</span> is the potential outcome in pre-treatment period. All forms of potential outcomes are revealed (observed) except
<span class="math inline">\(E(Y^0(1) | D = 1)\)</span>, which is average outcome for the treated group in the post-treatment period in absence of the treatment.</p>
<p>How does the parallel trend assumption help? To see this, lets expand equation @ref{eq:att}.</p>
<p><span class="math display">\[
\begin{align}
\tau = E(Y^1(1)| D = 1) - E(Y^0(1)| D = 1) \\
= E(Y^1(1)| D = 1) - E(Y^0(1)| D = 1) + E(Y^0(0)| D = 1) - E(Y^0(0)| D = 1) \\
= \{E(Y^1(1)| D = 1) - E(Y^0(0)| D = 1)\} - \{E(Y^0(1)| D = 1) - E(Y^0(0)| D = 1)\}  \\
= \{E(Y^1(1)| D = 1) - E(Y^0(0)| D = 1)\} - \{E(Y^0(1)| D = 0) - E(Y^0(0)| D = 0)\}  \\
= \{E(Y(1)| D = 1) - E(Y(0)| D = 1)\} - \{E(Y(1)| D = 0) - E(Y(0)| D = 0)\}  
\end{align}
\]</span></p>
<p>Moving from line 3 to 4 makes use of the parallel trend assumption as given in equation @ref{eq:ptrend1}. So it turns out that under the parallel
trend assumption, DiD framework uncovers the ATT. However, the parallel trend assumption cannot be tested given that potential outcome of the treated group
in absence of the treatment is not observed.</p>
<p>If we cannot provide a feasible test for the parallel trend assumption, how can we then attest for the validity of the DiD estimate?</p>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>The drop in uninsured rate for the control group can be explained by the implementation of other aspects of ACA such as subsidies and employment mandate.<a href="difference-in-differences-framework.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="naive-estimator.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="evidence-regarding-parallel-trend.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": false,
"toc": {
"collapse": "subsection"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
